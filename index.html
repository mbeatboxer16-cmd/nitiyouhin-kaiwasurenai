<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥ç”¨å“è²·ã„å¿˜ã‚Œé˜²æ­¢ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
        background: linear-gradient(135deg, #D4A574 0%, #C9A88F 100%);
        min-height: 100vh;
        padding: 10px;
    }

    .container {
        max-width: 800px;
        margin: 0 auto;
        background: #FFF8F0;
        border-radius: 25px;
        box-shadow: 0 15px 40px rgba(139, 111, 71, 0.3);
        overflow: hidden;
    }

    .header {
        background: linear-gradient(135deg, #8B6F47 0%, #A0826D 100%);
        color: #FFF8F0;
        padding: 25px;
        text-align: center;
        border-bottom: 4px solid #D4A574;
    }

    .header h1 {
        font-size: 26px;
        margin-bottom: 8px;
        font-weight: 900;
        letter-spacing: 1px;
    }

    .header .subtitle {
        font-size: 14px;
        opacity: 0.95;
        font-weight: 500;
    }

    .tabs {
        display: flex;
        background: #F5E6D3;
        border-bottom: 3px solid #D4A574;
        overflow-x: auto;
    }

    .tab {
        flex: 1;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        border: none;
        background: none;
        font-size: 14px;
        font-weight: bold;
        color: #8B6F47;
        transition: all 0.3s;
        white-space: nowrap;
        min-width: 100px;
        position: relative;
    }

    .tab-icon {
        font-size: 20px;
    }

    .tab-label {
        margin-left: 5px;
    }

    .tab.active {
        color: #6B4423;
        background: #FFF8F0;
        border-bottom: 4px solid #8B6F47;
    }

    .tab:hover {
        background: #F0DCC8;
    }

    /* ã‚¹ãƒãƒ›ç”¨ - ä¸‹éƒ¨å›ºå®šã‚¿ãƒ– */
    @media (max-width: 768px) {
        .tabs {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: #FFF8F0;
            border-top: 3px solid #D4A574;
            border-bottom: none;
            box-shadow: 0 -4px 15px rgba(139, 111, 71, 0.2);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .tab {
            padding: 8px 5px;
            font-size: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            min-width: 60px;
        }

        .tab-icon {
            font-size: 24px;
        }

        .tab-label {
            margin-left: 0;
            font-size: 10px;
        }

        .tab.active {
            border-bottom: none;
            border-top: 4px solid #8B6F47;
            color: #6B4423;
        }

        .content {
            padding: 15px;
            padding-bottom: 85px;
        }

        .header h1 {
            font-size: 22px;
        }

        .stats {
            grid-template-columns: 1fr 1fr;
        }

        #dashboardBadge {
            top: 3px !important;
            right: 3px !important;
        }
    }

    .content {
        padding: 20px;
    }

    .section {
        display: none;
    }

    .section.active {
        display: block;
    }

    .card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        border: 3px solid #F5E6D3;
        box-shadow: 0 4px 10px rgba(139, 111, 71, 0.1);
    }

    .card.danger {
        border-color: #E89B8A;
        background: #FFF5F5;
    }

    .card.warning {
        border-color: #F4C47E;
        background: #FFFEF5;
    }

    .card.success {
        border-color: #A8C99C;
        background: #F5FFF5;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #6B4423;
        font-size: 14px;
    }

    .form-group input,
    .form-group select {
        width: 100%;
        padding: 12px;
        border: 3px solid #F5E6D3;
        border-radius: 12px;
        font-size: 14px;
        background: white;
        transition: all 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: #D4A574;
        box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.2);
    }

    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        transition: all 0.3s;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .btn:active {
        transform: translateY(2px);
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .btn-primary {
        background: linear-gradient(135deg, #8B6F47 0%, #A0826D 100%);
        color: white;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #6B4423 0%, #8B6F47 100%);
    }

    .btn-success {
        background: linear-gradient(135deg, #A8C99C 0%, #8FBC8F 100%);
        color: white;
    }

    .btn-success:hover {
        background: linear-gradient(135deg, #8FBC8F 0%, #7AA874 100%);
    }

    .btn-danger {
        background: linear-gradient(135deg, #E89B8A 0%, #DC8B7A 100%);
        color: white;
    }

    .btn-danger:hover {
        background: linear-gradient(135deg, #DC8B7A 0%, #CC7B6A 100%);
    }

    .btn-secondary {
        background: linear-gradient(135deg, #B8A99A 0%, #A89888 100%);
        color: white;
    }

    .btn-secondary:hover {
        background: linear-gradient(135deg, #A89888 0%, #988878 100%);
    }

    .btn-small {
        padding: 6px 12px;
        font-size: 12px;
    }

    .item-list {
        margin-top: 20px;
    }

    .item {
        background: white;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 15px;
        border: 2px solid #F5E6D3;
        transition: all 0.3s;
    }

    .item:hover {
        border-color: #D4A574;
        box-shadow: 0 4px 12px rgba(139, 111, 71, 0.15);
    }

    .item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .item-name {
        font-size: 16px;
        font-weight: bold;
        color: #6B4423;
    }

    .item-details {
        font-size: 13px;
        color: #8B6F47;
        margin-bottom: 5px;
    }

    .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 11px;
        font-weight: bold;
        margin-right: 5px;
    }

    .badge-danger {
        background: #E89B8A;
        color: white;
    }

    .badge-warning {
        background: #F4C47E;
        color: #6B4423;
    }

    .badge-success {
        background: #A8C99C;
        color: white;
    }

    .badge-info {
        background: #D4A574;
        color: white;
    }

    .badge-store-super {
        background: linear-gradient(135deg, #A8C99C 0%, #8FBC8F 100%);
        color: white;
    }

    .badge-store-drug {
        background: linear-gradient(135deg, #9BB8E8 0%, #7A9FD8 100%);
        color: white;
    }

    .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .stat-card {
        background: linear-gradient(135deg, #8B6F47 0%, #A0826D 100%);
        color: white;
        padding: 20px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 6px 15px rgba(139, 111, 71, 0.3);
    }

    .stat-number {
        font-size: 36px;
        font-weight: bold;
    }

    .stat-label {
        font-size: 12px;
        opacity: 0.95;
        margin-top: 5px;
        font-weight: 600;
    }

    .empty-state {
        text-align: center;
        padding: 40px;
        color: #8B6F47;
    }

    .empty-state-icon {
        font-size: 48px;
        margin-bottom: 10px;
    }

    .data-management {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 20px;
    }

    .history-item {
        background: white;
        padding: 12px;
        margin-bottom: 8px;
        border-radius: 12px;
        border-left: 4px solid #D4A574;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .alert {
        padding: 15px;
        border-radius: 15px;
        margin-bottom: 15px;
        font-size: 14px;
        font-weight: 600;
    }

    .alert-info {
        background: #E8F4F8;
        color: #2C5F7B;
        border-left: 4px solid #5DADE2;
    }

    /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
    .checkbox-container {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 10px;
    }

    .checkbox-container input[type="checkbox"] {
        width: 24px;
        height: 24px;
        cursor: pointer;
        accent-color: #8B6F47;
    }

    .checkbox-label {
        flex: 1;
        cursor: pointer;
    }

    /* ã‚¹ã‚¯ã‚·ãƒ§ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
        background: #FFF8F0;
        margin: 5% auto;
        padding: 0;
        border-radius: 25px;
        max-width: 500px;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 15px 50px rgba(0,0,0,0.3);
    }

    .modal-header {
        background: linear-gradient(135deg, #8B6F47 0%, #A0826D 100%);
        color: white;
        padding: 20px;
        border-radius: 25px 25px 0 0;
        text-align: center;
    }

    .modal-body {
        padding: 20px;
    }

    .screenshot-item {
        background: white;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 15px;
        border-left: 4px solid #D4A574;
    }

    .close-btn {
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 28px;
        font-weight: bold;
        color: white;
        cursor: pointer;
    }

    @media print {
        body {
            background: white;
        }
        .tabs, .btn, .data-management, .close-btn {
            display: none !important;
        }
        .modal-content {
            box-shadow: none;
            margin: 0;
            max-width: 100%;
        }
        /* ãƒ•ãƒªãƒ¼ãƒªã‚¹ãƒˆå°åˆ·æ™‚ã¯å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’éè¡¨ç¤º */
        #freelist .card:first-child {
            display: none !important;
        }
        #freelist > div:nth-child(2) {
            display: none !important;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›’âœ¨ æ—¥ç”¨å“è²·ã„å¿˜ã‚Œé˜²æ­¢ã‚¢ãƒ—ãƒª</h1>
            <div class="subtitle">ã‹ã‚ã„ãè³¢ããŠè²·ã„ç‰©ç®¡ç† â˜•</div>
        </div>

```
    <div class="tabs">
        <button class="tab active" onclick="showTab('dashboard')">
            <span class="tab-icon">ğŸ </span>
            <span class="tab-label">ãƒ›ãƒ¼ãƒ </span>
            <span id="dashboardBadge" class="badge badge-danger" style="display: none; position: absolute; top: 5px; right: 5px; font-size: 10px; min-width: 18px; height: 18px; padding: 3px; border-radius: 50%;"></span>
        </button>
        <button class="tab" onclick="showTab('freelist')">
            <span class="tab-icon">âœï¸</span>
            <span class="tab-label">ãƒªã‚¹ãƒˆ</span>
        </button>
        <button class="tab" onclick="showTab('master')">
            <span class="tab-icon">ğŸ“‹</span>
            <span class="tab-label">ãƒã‚¹ã‚¿ãƒ¼</span>
        </button>
        <button class="tab" onclick="showTab('shopping')">
            <span class="tab-icon">ğŸ›ï¸</span>
            <span class="tab-label">è³¼å…¥</span>
        </button>
        <button class="tab" onclick="showTab('history')">
            <span class="tab-icon">ğŸ“–</span>
            <span class="tab-label">å±¥æ­´</span>
        </button>
        <button class="tab" onclick="showTab('data')">
            <span class="tab-icon">âš™ï¸</span>
            <span class="tab-label">è¨­å®š</span>
        </button>
    </div>

    <div class="content">
        <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
        <div id="dashboard" class="section active">
            <div class="stats" id="statsContainer"></div>
            
            <div id="urgentAlert" class="alert" style="display: none; background: #fff3cd; border-left: 4px solid #ffc107; margin-bottom: 20px;">
                <strong>âš ï¸ è³¼å…¥ãŒå¿…è¦ãªå•†å“ãŒã‚ã‚Šã¾ã™ï¼</strong>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="openShoppingListModal()" style="font-size: 16px; padding: 15px 30px;">
                    ğŸ“ ä»Šæ—¥ã®è²·ã„ç‰©ãƒªã‚¹ãƒˆã‚’ä½œã‚‹
                </button>
            </div>
            
            <h3 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px; color: #6B4423;">
                ğŸ”¥ ä»Šé€±ã®è²·ã„ç‰©ãƒªã‚¹ãƒˆ
                <span id="weeklyBadge" class="badge badge-danger" style="display: none; font-size: 14px;"></span>
            </h3>
            <div id="shoppingList"></div>
            
            <h3 style="margin-bottom: 15px; margin-top: 30px; color: #8B6F47;">âœ… è³¼å…¥æ¸ˆã¿ãƒ»ä½™è£•ã‚ã‚Š</h3>
            <div id="okList"></div>
        </div>

        <!-- ãƒ•ãƒªãƒ¼è²·ã„ç‰©ãƒªã‚¹ãƒˆ -->
        <div id="freelist" class="section">
            <div class="card">
                <h3 style="margin-bottom: 15px; color: #6B4423;">âœï¸ è‡ªç”±ã«è²·ã„ç‰©ãƒªã‚¹ãƒˆã‚’ä½œæˆ</h3>
                <p style="color: #8B6F47; margin-bottom: 15px; font-size: 13px;">
                    ç™»éŒ²å•†å“ã‹ã‚‰é¸ã¶ã‹ã€è‡ªç”±ã«å…¥åŠ›ã—ã¦ãƒªã‚¹ãƒˆã‚’ä½œæˆã§ãã¾ã™
                </p>
                
                <div class="form-group">
                    <label>ç™»éŒ²å•†å“ã‹ã‚‰é¸æŠ</label>
                    <select id="freeListItemSelect" onchange="addFromMaster()">
                        <option value="">å•†å“ã‚’é¸æŠ...</option>
                    </select>
                </div>

                <div style="display: flex; align-items: center; margin: 15px 0; color: #8B6F47;">
                    <div style="flex: 1; height: 1px; background: #D4A574;"></div>
                    <span style="margin: 0 10px; font-weight: bold;">ã¾ãŸã¯</span>
                    <div style="flex: 1; height: 1px; background: #D4A574;"></div>
                </div>

                <div class="form-group">
                    <label>è‡ªç”±å…¥åŠ›</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="freeListItemInput" placeholder="å•†å“åã‚’å…¥åŠ›..." style="flex: 1;" onkeypress="if(event.key==='Enter') addFreeListItem()">
                        <select id="freeListCategoryInput" style="width: 150px;">
                            <option value="æ—¥ç”¨å“">æ—¥ç”¨å“</option>
                            <option value="é£Ÿå“">é£Ÿå“</option>
                            <option value="æ´—å‰¤">æ´—å‰¤</option>
                            <option value="ãƒˆã‚¤ãƒ¬ç”¨å“">ãƒˆã‚¤ãƒ¬ç”¨å“</option>
                            <option value="ã‚­ãƒƒãƒãƒ³ç”¨å“">ã‚­ãƒƒãƒãƒ³ç”¨å“</option>
                            <option value="ãã®ä»–">ãã®ä»–</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <select id="freeListStoreInput" style="flex: 1;">
                            <option value="ã‚¹ãƒ¼ãƒ‘ãƒ¼">ğŸ›’ ã‚¹ãƒ¼ãƒ‘ãƒ¼</option>
                            <option value="ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢">ğŸ’Š ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-success" onclick="addFreeListItem()">â• ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
            </div>

            <div style="margin-top: 20px; text-align: center; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="printFreeList()" style="font-size: 16px; padding: 12px 25px;">
                    ğŸ“¸ ã‚¹ã‚¯ã‚·ãƒ§/å°åˆ·
                </button>
                <button class="btn btn-danger" onclick="clearFreeList()">
                    ğŸ—‘ï¸ ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
                </button>
            </div>

            <div id="freeListContainer" style="margin-top: 20px;"></div>
        </div>

        <!-- æ—¥ç”¨å“ãƒã‚¹ã‚¿ãƒ¼ -->
        <div id="master" class="section">
            <div class="card">
                <h3 style="margin-bottom: 15px;">æ–°è¦æ—¥ç”¨å“ç™»éŒ²</h3>
                <div class="form-group">
                    <label>å“å *</label>
                    <input type="text" id="itemName" placeholder="ä¾‹: ãƒ†ã‚£ãƒƒã‚·ãƒ¥ãƒšãƒ¼ãƒ‘ãƒ¼">
                </div>
                <div class="form-group">
                    <label>ä»•å…¥ã‚Œå‘¨æœŸï¼ˆæ—¥æ•°ï¼‰ *</label>
                    <input type="number" id="itemCycle" placeholder="ä¾‹: 30" min="1">
                </div>
                <div class="form-group">
                    <label>ã‚«ãƒ†ã‚´ãƒª</label>
                    <select id="itemCategory">
                        <option value="æ—¥ç”¨å“">æ—¥ç”¨å“</option>
                        <option value="é£Ÿå“">é£Ÿå“</option>
                        <option value="æ´—å‰¤">æ´—å‰¤</option>
                        <option value="ãƒˆã‚¤ãƒ¬ç”¨å“">ãƒˆã‚¤ãƒ¬ç”¨å“</option>
                        <option value="ã‚­ãƒƒãƒãƒ³ç”¨å“">ã‚­ãƒƒãƒãƒ³ç”¨å“</option>
                        <option value="ãã®ä»–">ãã®ä»–</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>è³¼å…¥åº—èˆ— *</label>
                    <select id="itemStore">
                        <option value="ã‚¹ãƒ¼ãƒ‘ãƒ¼">ğŸ›’ ã‚¹ãƒ¼ãƒ‘ãƒ¼</option>
                        <option value="ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢">ğŸ’Š ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="addItem()">â• ç™»éŒ²</button>
            </div>

            <div class="item-list" id="masterList"></div>
        </div>

        <!-- ãŠè²·ã„ç‰©ç™»éŒ² -->
        <div id="shopping" class="section">
            <div class="card">
                <h3 style="margin-bottom: 15px;">è³¼å…¥è¨˜éŒ²</h3>
                <div class="form-group">
                    <label>å•†å“é¸æŠ *</label>
                    <select id="purchaseItem">
                        <option value="">å•†å“ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>è³¼å…¥æ—¥ *</label>
                    <input type="date" id="purchaseDate">
                </div>
                <button class="btn btn-success" onclick="recordPurchase()">âœ… è³¼å…¥è¨˜éŒ²</button>
            </div>

            <div class="alert alert-info" style="margin-top: 20px;">
                ğŸ’¡ è³¼å…¥ã—ãŸå•†å“ã‚’è¨˜éŒ²ã™ã‚‹ã¨ã€æ¬¡å›è³¼å…¥äºˆå®šæ—¥ãŒè‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™
            </div>
        </div>

        <!-- è³¼å…¥å±¥æ­´ -->
        <div id="history" class="section">
            <h3 style="margin-bottom: 15px;">ğŸ“œ è³¼å…¥å±¥æ­´</h3>
            <div id="historyList"></div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç† -->
        <div id="data" class="section">
            <div class="card">
                <h3 style="margin-bottom: 15px;">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
                
                <h4 style="margin: 15px 0 10px 0;">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</h4>
                <div class="data-management">
                    <button class="btn btn-primary" onclick="exportData()">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <button class="btn btn-secondary" onclick="printData()">ğŸ–¨ï¸ å°åˆ·</button>
                </div>

                <h4 style="margin: 20px 0 10px 0;">ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ</h4>
                <div class="form-group">
                    <input type="file" id="importFile" accept=".json" style="margin-bottom: 10px;">
                    <button class="btn btn-success" onclick="importData()">ğŸ“¤ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                </div>

                <h4 style="margin: 20px 0 10px 0;">ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</h4>
                <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3 style="margin-bottom: 10px;">ğŸ“Š ãƒ‡ãƒ¼ã‚¿çµ±è¨ˆ</h3>
                <div id="dataStats"></div>
            </div>
        </div>
    </div>
</div>

<!-- è²·ã„ç‰©ãƒªã‚¹ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="shoppingListModal" class="modal">
    <div class="modal-content">
        <div class="modal-header" style="position: relative;">
            <span class="close-btn" onclick="closeShoppingListModal()">&times;</span>
            <h2 style="font-size: 22px; margin: 0;">ğŸ›’ ä»Šæ—¥ã®è²·ã„ç‰©ãƒªã‚¹ãƒˆ</h2>
            <p style="font-size: 13px; margin-top: 8px; opacity: 0.9;">
                ğŸ“… <span id="modalDate"></span>
            </p>
        </div>
        <div class="modal-body">
            <div id="selectedItemsList"></div>
            <div style="text-align: center; margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-success" onclick="captureScreenshot()">ğŸ“¸ ã‚¹ã‚¯ã‚·ãƒ§ä¿å­˜</button>
                <button class="btn btn-primary" onclick="printShoppingList()">ğŸ–¨ï¸ å°åˆ·</button>
                <button class="btn btn-secondary" onclick="closeShoppingListModal()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>
</div>

<!-- æ—¥ç”¨å“ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="editItemModal" class="modal">
    <div class="modal-content">
        <div class="modal-header" style="position: relative;">
            <span class="close-btn" onclick="closeEditModal()">&times;</span>
            <h2 style="font-size: 22px; margin: 0;">âœï¸ æ—¥ç”¨å“ã‚’ç·¨é›†</h2>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>å“å *</label>
                <input type="text" id="editItemName" placeholder="ä¾‹: ãƒ†ã‚£ãƒƒã‚·ãƒ¥ãƒšãƒ¼ãƒ‘ãƒ¼">
            </div>
            <div class="form-group">
                <label>ä»•å…¥ã‚Œå‘¨æœŸï¼ˆæ—¥æ•°ï¼‰ *</label>
                <input type="number" id="editItemCycle" placeholder="ä¾‹: 30" min="1">
            </div>
            <div class="form-group">
                <label>ã‚«ãƒ†ã‚´ãƒª</label>
                <select id="editItemCategory">
                    <option value="æ—¥ç”¨å“">æ—¥ç”¨å“</option>
                    <option value="é£Ÿå“">é£Ÿå“</option>
                    <option value="æ´—å‰¤">æ´—å‰¤</option>
                    <option value="ãƒˆã‚¤ãƒ¬ç”¨å“">ãƒˆã‚¤ãƒ¬ç”¨å“</option>
                    <option value="ã‚­ãƒƒãƒãƒ³ç”¨å“">ã‚­ãƒƒãƒãƒ³ç”¨å“</option>
                    <option value="ãã®ä»–">ãã®ä»–</option>
                </select>
            </div>
            <div class="form-group">
                <label>è³¼å…¥åº—èˆ— *</label>
                <select id="editItemStore">
                    <option value="ã‚¹ãƒ¼ãƒ‘ãƒ¼">ğŸ›’ ã‚¹ãƒ¼ãƒ‘ãƒ¼</option>
                    <option value="ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢">ğŸ’Š ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢</option>
                </select>
            </div>
            <div style="text-align: center; margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                <button class="btn btn-primary" onclick="saveEditedItem()">ğŸ’¾ ä¿å­˜</button>
                <button class="btn btn-secondary" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
    let items = JSON.parse(localStorage.getItem('items')) || [];
    let purchases = JSON.parse(localStorage.getItem('purchases')) || [];
    let selectedItems = new Set(); // é¸æŠã•ã‚ŒãŸå•†å“ã®ID
    let editingItemId = null; // ç·¨é›†ä¸­ã®ã‚¢ã‚¤ãƒ†ãƒ ID
    let freeList = []; // ãƒ•ãƒªãƒ¼ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ï¼ˆä¸€æ™‚çš„ã€ä¿å­˜ã—ãªã„ï¼‰

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('purchaseDate').valueAsDate = new Date();
        loadData();
    });

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function showTab(tabName) {
        // å…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³éè¡¨ç¤º
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });
        
        // å…¨ã‚¿ãƒ–éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });

        // é¸æŠã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
        document.getElementById(tabName).classList.add('active');
        event.target.classList.add('active');

        // ãƒ‡ãƒ¼ã‚¿å†èª­ã¿è¾¼ã¿
        loadData();
    }

    // æ—¥ç”¨å“è¿½åŠ 
    function addItem() {
        const name = document.getElementById('itemName').value.trim();
        const cycle = parseInt(document.getElementById('itemCycle').value);
        const category = document.getElementById('itemCategory').value;
        const store = document.getElementById('itemStore').value;

        if (!name || !cycle) {
            alert('å“åã¨ä»•å…¥ã‚Œå‘¨æœŸã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
        }

        const item = {
            id: Date.now(),
            name: name,
            cycle: cycle,
            category: category,
            store: store,
            createdAt: new Date().toISOString()
        };

        items.push(item);
        saveData();
        
        // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
        document.getElementById('itemName').value = '';
        document.getElementById('itemCycle').value = '';
        
        loadData();
        alert('æ—¥ç”¨å“ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
    }

    // æ—¥ç”¨å“å‰Šé™¤
    function deleteItem(id) {
        if (!confirm('ã“ã®æ—¥ç”¨å“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
        
        items = items.filter(item => item.id !== id);
        purchases = purchases.filter(purchase => purchase.itemId !== id);
        saveData();
        loadData();
    }

    // è³¼å…¥è¨˜éŒ²
    function recordPurchase() {
        const itemId = parseInt(document.getElementById('purchaseItem').value);
        const date = document.getElementById('purchaseDate').value;

        if (!itemId || !date) {
            alert('å•†å“ã¨è³¼å…¥æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
            return;
        }

        const item = items.find(i => i.id === itemId);
        if (!item) return;

        const purchase = {
            id: Date.now(),
            itemId: itemId,
            itemName: item.name,
            purchaseDate: date,
            nextPurchaseDate: calculateNextDate(date, item.cycle)
        };

        purchases.push(purchase);
        saveData();
        loadData();
        
        alert(`${item.name}ã®è³¼å…¥ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ\næ¬¡å›è³¼å…¥äºˆå®š: ${formatDate(purchase.nextPurchaseDate)}`);
    }

    // æ¬¡å›è³¼å…¥æ—¥è¨ˆç®—
    function calculateNextDate(dateStr, cycle) {
        const date = new Date(dateStr);
        date.setDate(date.getDate() + cycle);
        return date.toISOString().split('T')[0];
    }

    // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatDate(dateStr) {
        const date = new Date(dateStr);
        return `${date.getFullYear()}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')}`;
    }

    // æ—¥æ•°å·®è¨ˆç®—
    function getDaysDiff(dateStr) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const targetDate = new Date(dateStr);
        targetDate.setHours(0, 0, 0, 0);
        return Math.floor((targetDate - today) / (1000 * 60 * 60 * 24));
    }

    // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
    function saveData() {
        localStorage.setItem('items', JSON.stringify(items));
        localStorage.setItem('purchases', JSON.stringify(purchases));
    }

    // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    function loadData() {
        loadMasterList();
        loadDashboard();
        loadPurchaseSelect();
        loadHistory();
        loadDataStats();
        loadFreeListSelect();
    }

    // ========== ãƒ•ãƒªãƒ¼ãƒªã‚¹ãƒˆé–¢é€£ ==========
    
    // ãƒ•ãƒªãƒ¼ãƒªã‚¹ãƒˆã®é¸æŠè‚¢ã‚’èª­ã¿è¾¼ã¿
    function loadFreeListSelect() {
        const select = document.getElementById('freeListItemSelect');
        select.innerHTML = '<option value="">å•†å“ã‚’é¸æŠ...</option>' + 
            items.map(item => `<option value="${item.id}">${item.name} (${item.category})</option>`).join('');
    }

    // ç™»éŒ²å•†å“ã‹ã‚‰è¿½åŠ 
    function addFromMaster() {
        const select = document.getElementById('freeListItemSelect');
        const itemId = parseInt(select.value);
        
        if (!itemId) return;
        
        const item = items.find(i => i.id === itemId);
        if (!item) return;

        // æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        if (freeList.some(fl => fl.name === item.name)) {
            alert('ã“ã®å•†å“ã¯æ—¢ã«ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
            select.value = '';
            return;
        }

        freeList.push({
            id: Date.now(),
            name: item.name,
            category: item.category,
            store: item.store || 'ã‚¹ãƒ¼ãƒ‘ãƒ¼',
            checked: false
        });

        select.value = '';
        renderFreeList();
    }

    // è‡ªç”±å…¥åŠ›ã§è¿½åŠ 
    function addFreeListItem() {
        const input = document.getElementById('freeListItemInput');
        const categorySelect = document.getElementById('freeListCategoryInput');
        const storeSelect = document.getElementById('freeListStoreInput');
        const name = input.value.trim();
        const category = categorySelect.value;
        const store = storeSelect.value;

        if (!name) {
            alert('å•†å“åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
        }

        // æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        if (freeList.some(fl => fl.name === name)) {
            alert('ã“ã®å•†å“ã¯æ—¢ã«ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
            return;
        }

        freeList.push({
            id: Date.now(),
            name: name,
            category: category,
            store: store,
            checked: false
        });

        input.value = '';
        renderFreeList();
    }

    // ãƒ•ãƒªãƒ¼ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
    function renderFreeList() {
        const container = document.getElementById('freeListContainer');

        if (freeList.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“</div>
                    <p>ãƒªã‚¹ãƒˆãŒç©ºã§ã™<br>å•†å“ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>
                </div>
            `;
            return;
        }

        // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
        const byCategory = {};
        freeList.forEach(item => {
            if (!byCategory[item.category]) {
                byCategory[item.category] = [];
            }
            byCategory[item.category].push(item);
        });

        let html = '<div style="margin-bottom: 15px; text-align: center; font-weight: bold; color: #6B4423; font-size: 18px;">';
        html += `ğŸ“… ${new Date().getFullYear()}å¹´${new Date().getMonth() + 1}æœˆ${new Date().getDate()}æ—¥ã®è²·ã„ç‰©ãƒªã‚¹ãƒˆ`;
        html += '</div>';

        for (const [category, categoryItems] of Object.entries(byCategory)) {
            html += `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #8B6F47; margin-bottom: 10px; font-size: 16px;">
                        ğŸ“‚ ${category} (${categoryItems.length}ä»¶)
                    </h4>
                    ${categoryItems.map(item => {
                        const storeBadgeClass = item.store === 'ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢' ? 'badge-store-drug' : 'badge-store-super';
                        const storeIcon = item.store === 'ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢' ? 'ğŸ’Š' : 'ğŸ›’';
                        
                        return `
                        <div class="card" style="margin-bottom: 8px;">
                            <div class="checkbox-container">
                                <input type="checkbox" id="free_${item.id}" 
                                       ${item.checked ? 'checked' : ''} 
                                       onchange="toggleFreeListItem(${item.id})">
                                <label class="checkbox-label" for="free_${item.id}" 
                                       style="${item.checked ? 'text-decoration: line-through; opacity: 0.6;' : ''}">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div style="flex: 1;">
                                            <div style="font-weight: bold; font-size: 15px; color: #6B4423;">
                                                ${item.name}
                                            </div>
                                            <div style="font-size: 12px; margin-top: 3px;">
                                                <span class="badge ${storeBadgeClass}">${storeIcon} ${item.store || 'ã‚¹ãƒ¼ãƒ‘ãƒ¼'}</span>
                                            </div>
                                        </div>
                                        <button class="btn btn-danger btn-small" 
                                                onclick="removeFreeListItem(${item.id}); event.stopPropagation();"
                                                style="margin-left: 10px;">
                                            âœ•
                                        </button>
                                    </div>
                                </label>
                            </div>
                        </div>
                    `}).join('')}
                </div>
            `;
        }

        html += `
            <div style="text-align: center; margin-top: 20px; padding: 15px; background: #F5E6D3; border-radius: 15px;">
                <div style="font-size: 20px; font-weight: bold; color: #6B4423;">
                    åˆè¨ˆ: ${freeList.length}ä»¶
                </div>
                <div style="font-size: 14px; color: #8B6F47; margin-top: 5px;">
                    å®Œäº†: ${freeList.filter(i => i.checked).length}ä»¶ / 
                    æ®‹ã‚Š: ${freeList.filter(i => !i.checked).length}ä»¶
                </div>
            </div>
        `;

        container.innerHTML = html;
    }

    // ãƒ•ãƒªãƒ¼ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®ãƒã‚§ãƒƒã‚¯åˆ‡ã‚Šæ›¿ãˆ
    function toggleFreeListItem(itemId) {
        const item = freeList.find(i => i.id === itemId);
        if (item) {
            item.checked = !item.checked;
            renderFreeList();
        }
    }

    // ãƒ•ãƒªãƒ¼ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
    function removeFreeListItem(itemId) {
        freeList = freeList.filter(i => i.id !== itemId);
        renderFreeList();
    }

    // ãƒ•ãƒªãƒ¼ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
    function clearFreeList() {
        if (freeList.length === 0) {
            alert('ãƒªã‚¹ãƒˆã¯æ—¢ã«ç©ºã§ã™');
            return;
        }
        
        if (!confirm('ãƒªã‚¹ãƒˆã‚’å…¨ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) return;
        
        freeList = [];
        renderFreeList();
    }

    // ãƒ•ãƒªãƒ¼ãƒªã‚¹ãƒˆã‚’å°åˆ·
    function printFreeList() {
        if (freeList.length === 0) {
            alert('ãƒªã‚¹ãƒˆãŒç©ºã§ã™ã€‚å•†å“ã‚’è¿½åŠ ã—ã¦ã‹ã‚‰å°åˆ·ã—ã¦ãã ã•ã„');
            return;
        }
        window.print();
    }

    // ========== ãƒ•ãƒªãƒ¼ãƒªã‚¹ãƒˆé–¢é€£ã“ã“ã¾ã§ ==========


    // ãƒã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆè¡¨ç¤º
    function loadMasterList() {
        const container = document.getElementById('masterList');
        
        if (items.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“¦</div>
                    <p>æ—¥ç”¨å“ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                </div>
            `;
            return;
        }

        container.innerHTML = items.map(item => {
            const latestPurchase = purchases
                .filter(p => p.itemId === item.id)
                .sort((a, b) => new Date(b.purchaseDate) - new Date(a.purchaseDate))[0];
            
            const storeBadgeClass = item.store === 'ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢' ? 'badge-store-drug' : 'badge-store-super';
            const storeIcon = item.store === 'ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢' ? 'ğŸ’Š' : 'ğŸ›’';

            return `
                <div class="item">
                    <div class="item-header">
                        <div class="item-name">${item.name}</div>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-primary btn-small" onclick="openEditModal(${item.id})">âœï¸ ç·¨é›†</button>
                            <button class="btn btn-danger btn-small" onclick="deleteItem(${item.id})">ğŸ—‘ï¸ å‰Šé™¤</button>
                        </div>
                    </div>
                    <div class="item-details">
                        <span class="badge badge-info">${item.category}</span>
                        <span class="badge ${storeBadgeClass}">${storeIcon} ${item.store || 'ã‚¹ãƒ¼ãƒ‘ãƒ¼'}</span>
                        å‘¨æœŸ: ${item.cycle}æ—¥
                    </div>
                    ${latestPurchase ? `
                        <div class="item-details">
                            æœ€çµ‚è³¼å…¥: ${formatDate(latestPurchase.purchaseDate)} | 
                            æ¬¡å›äºˆå®š: ${formatDate(latestPurchase.nextPurchaseDate)}
                        </div>
                    ` : `
                        <div class="item-details" style="color: #E89B8A;">
                            ã¾ã è³¼å…¥è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“
                        </div>
                    `}
                </div>
            `;
        }).join('');
    }

    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
    function loadDashboard() {
        // çµ±è¨ˆæƒ…å ±
        const statsContainer = document.getElementById('statsContainer');
        const itemsNeedToBuy = getItemsNeedToBuy();
        
        statsContainer.innerHTML = `
            <div class="stat-card">
                <div class="stat-number">${items.length}</div>
                <div class="stat-label">ç™»éŒ²å•†å“æ•°</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #E89B8A 0%, #DC8B7A 100%);">
                <div class="stat-number">${itemsNeedToBuy.urgent}</div>
                <div class="stat-label">è¦è³¼å…¥ï¼ˆæœŸé™åˆ‡ã‚Œï¼‰</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #A8C99C 0%, #8FBC8F 100%);">
                <div class="stat-number">${itemsNeedToBuy.soon}</div>
                <div class="stat-label">ä»Šé€±ä¸­ã«è³¼å…¥</div>
            </div>
        `;

        // é€šçŸ¥ãƒãƒƒã‚¸æ›´æ–°
        const totalNeed = itemsNeedToBuy.urgent + itemsNeedToBuy.soon;
        const dashboardBadge = document.getElementById('dashboardBadge');
        const weeklyBadge = document.getElementById('weeklyBadge');
        
        if (totalNeed > 0) {
            dashboardBadge.style.display = 'inline-block';
            dashboardBadge.textContent = totalNeed;
            weeklyBadge.style.display = 'inline-block';
            weeklyBadge.textContent = `${totalNeed}ä»¶`;
            document.getElementById('urgentAlert').style.display = 'block';
        } else {
            dashboardBadge.style.display = 'none';
            weeklyBadge.style.display = 'none';
            document.getElementById('urgentAlert').style.display = 'none';
        }

        // è²·ã„ç‰©ãƒªã‚¹ãƒˆï¼ˆ1é€±é–“ä»¥å†…ï¼‰
        const shoppingListContainer = document.getElementById('shoppingList');
        const allItems = generateShoppingList();
        const weeklyItems = allItems.filter(item => item.daysLeft <= 7);

        if (weeklyItems.length === 0) {
            shoppingListContainer.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">âœ…</div>
                    <p>ä»Šé€±è³¼å…¥ãŒå¿…è¦ãªå•†å“ã¯ã‚ã‚Šã¾ã›ã‚“</p>
                </div>
            `;
        } else {
            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const categories = {
                expired: weeklyItems.filter(item => item.daysLeft < 0),
                today: weeklyItems.filter(item => item.daysLeft === 0),
                threeDays: weeklyItems.filter(item => item.daysLeft > 0 && item.daysLeft <= 3),
                week: weeklyItems.filter(item => item.daysLeft > 3 && item.daysLeft <= 7)
            };

            let html = '';

            // æœŸé™åˆ‡ã‚Œ
            if (categories.expired.length > 0) {
                html += `<div style="margin-bottom: 20px;">
                    <h4 style="color: #dc3545; margin-bottom: 10px;">ğŸš¨ æœŸé™åˆ‡ã‚Œï¼ˆ${categories.expired.length}ä»¶ï¼‰</h4>
                    ${renderItems(categories.expired, 'danger')}
                </div>`;
            }

            // ä»Šæ—¥
            if (categories.today.length > 0) {
                html += `<div style="margin-bottom: 20px;">
                    <h4 style="color: #ff6b6b; margin-bottom: 10px;">ğŸ“ ä»Šæ—¥ãŒæœŸé™ï¼ˆ${categories.today.length}ä»¶ï¼‰</h4>
                    ${renderItems(categories.today, 'danger')}
                </div>`;
            }

            // 3æ—¥ä»¥å†…
            if (categories.threeDays.length > 0) {
                html += `<div style="margin-bottom: 20px;">
                    <h4 style="color: #ffc107; margin-bottom: 10px;">âš¡ 3æ—¥ä»¥å†…ï¼ˆ${categories.threeDays.length}ä»¶ï¼‰</h4>
                    ${renderItems(categories.threeDays, 'warning')}
                </div>`;
            }

            // 1é€±é–“ä»¥å†…
            if (categories.week.length > 0) {
                html += `<div style="margin-bottom: 20px;">
                    <h4 style="color: #28a745; margin-bottom: 10px;">ğŸ“… ä»Šé€±ä¸­ï¼ˆ${categories.week.length}ä»¶ï¼‰</h4>
                    ${renderItems(categories.week, 'success')}
                </div>`;
            }

            shoppingListContainer.innerHTML = html;
        }

        // ä½™è£•ãŒã‚ã‚‹å•†å“ãƒªã‚¹ãƒˆ
        const okListContainer = document.getElementById('okList');
        const okItems = allItems.filter(item => item.daysLeft > 7);
        
        if (okItems.length === 0) {
            okListContainer.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“¦</div>
                    <p>å…¨ã¦ã®å•†å“ãŒ1é€±é–“ä»¥å†…ã«è³¼å…¥äºˆå®šã§ã™</p>
                </div>
            `;
        } else {
            okListContainer.innerHTML = okItems.map(item => {
                const storeBadgeClass = item.store === 'ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢' ? 'badge-store-drug' : 'badge-store-super';
                const storeIcon = item.store === 'ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢' ? 'ğŸ’Š' : 'ğŸ›’';
                
                return `
                <div class="item" style="opacity: 0.7;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: bold; font-size: 14px;">
                                ${item.name}
                                <span class="badge badge-info">${item.category}</span>
                                <span class="badge ${storeBadgeClass}">${storeIcon} ${item.store}</span>
                            </div>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 3px;">
                                æ¬¡å›è³¼å…¥äºˆå®š: ${formatDate(item.nextDate)} (ã‚ã¨${item.daysLeft}æ—¥)
                            </div>
                        </div>
                    </div>
                </div>
            `}).join('');
        }
    }

    // ã‚¢ã‚¤ãƒ†ãƒ è¡¨ç¤ºç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    function renderItems(items, type) {
        return items.map(item => {
            let cardClass = 'card';
            let badge = '';
            let daysText = '';
            
            if (item.daysLeft < 0) {
                cardClass = 'card danger';
                badge = '<span class="badge badge-danger">æœŸé™åˆ‡ã‚Œ</span>';
                daysText = `${Math.abs(item.daysLeft)}æ—¥çµŒé`;
            } else if (item.daysLeft === 0) {
                cardClass = 'card danger';
                badge = '<span class="badge badge-danger">ä»Šæ—¥</span>';
                daysText = 'ä»Šæ—¥ãŒæœŸé™';
            } else if (item.daysLeft <= 3) {
                cardClass = 'card warning';
                badge = '<span class="badge badge-warning">è¦æ³¨æ„</span>';
                daysText = `ã‚ã¨${item.daysLeft}æ—¥`;
            } else if (item.daysLeft <= 7) {
                cardClass = 'card success';
                badge = '<span class="badge badge-success">ä»Šé€±ä¸­</span>';
                daysText = `ã‚ã¨${item.daysLeft}æ—¥`;
            }

            const storeBadgeClass = item.store === 'ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢' ? 'badge-store-drug' : 'badge-store-super';
            const storeIcon = item.store === 'ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢' ? 'ğŸ’Š' : 'ğŸ›’';

            return `
                <div class="${cardClass}">
                    <div class="checkbox-container">
                        <input type="checkbox" id="item_${item.id}" onchange="toggleItemSelection(${item.id})" ${selectedItems.has(item.id) ? 'checked' : ''}>
                        <label class="checkbox-label" for="item_${item.id}">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex: 1;">
                                    <div style="font-weight: bold; font-size: 16px; margin-bottom: 5px; color: #6B4423;">
                                        ${badge}
                                        ${item.name}
                                    </div>
                                    <div style="font-size: 13px; color: #8B6F47;">
                                        <span class="badge badge-info">${item.category}</span>
                                        <span class="badge ${storeBadgeClass}">${storeIcon} ${item.store || 'ã‚¹ãƒ¼ãƒ‘ãƒ¼'}</span>
                                        ${formatDate(item.nextDate)} (${daysText})
                                    </div>
                                </div>
                                <div style="text-align: right; font-size: 24px; font-weight: bold; color: ${
                                    item.daysLeft < 0 ? '#E89B8A' : 
                                    item.daysLeft === 0 ? '#E89B8A' :
                                    item.daysLeft <= 3 ? '#F4C47E' : '#A8C99C'
                                };">
                                    ${item.daysLeft < 0 ? '!' : item.daysLeft}
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
            `;
        }).join('');
    }

    // ã‚¢ã‚¤ãƒ†ãƒ é¸æŠåˆ‡ã‚Šæ›¿ãˆ
    function toggleItemSelection(itemId) {
        if (selectedItems.has(itemId)) {
            selectedItems.delete(itemId);
        } else {
            selectedItems.add(itemId);
        }
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆã¯æ›´æ–°
        if (document.getElementById('shoppingListModal').style.display === 'block') {
            updateSelectedItemsList();
        }
    }

    // è²·ã„ç‰©ãƒªã‚¹ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
    function openShoppingListModal() {
        const allItems = generateShoppingList();
        const weeklyItems = allItems.filter(item => item.daysLeft <= 7);
        
        if (weeklyItems.length === 0) {
            alert('ä»Šé€±è³¼å…¥ãŒå¿…è¦ãªå•†å“ãŒã‚ã‚Šã¾ã›ã‚“');
            return;
        }

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨ã‚¢ã‚¤ãƒ†ãƒ ã‚’é¸æŠ
        selectedItems.clear();
        weeklyItems.forEach(item => selectedItems.add(item.id));
        
        // æ—¥ä»˜ã‚’è¨­å®š
        const today = new Date();
        document.getElementById('modalDate').textContent = 
            `${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥`;
        
        // ã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
        updateSelectedItemsList();
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
        document.getElementById('shoppingListModal').style.display = 'block';
    }

    // é¸æŠã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆã‚’æ›´æ–°
    function updateSelectedItemsList() {
        const container = document.getElementById('selectedItemsList');
        const allItems = generateShoppingList();
        const selected = allItems.filter(item => selectedItems.has(item.id));
        
        if (selected.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“</div>
                    <p>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å•†å“ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                </div>
            `;
            return;
        }

        // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
        const byCategory = {};
        selected.forEach(item => {
            if (!byCategory[item.category]) {
                byCategory[item.category] = [];
            }
            byCategory[item.category].push(item);
        });

        let html = '';
        for (const [category, categoryItems] of Object.entries(byCategory)) {
            html += `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #8B6F47; margin-bottom: 10px; font-size: 16px;">
                        ğŸ“‚ ${category} (${categoryItems.length}ä»¶)
                    </h4>
                    ${categoryItems.map(item => {
                        const storeBadgeClass = item.store === 'ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢' ? 'badge-store-drug' : 'badge-store-super';
                        const storeIcon = item.store === 'ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢' ? 'ğŸ’Š' : 'ğŸ›’';
                        
                        return `
                        <div class="screenshot-item">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: bold; font-size: 15px; color: #6B4423; margin-bottom: 3px;">
                                        âœ“ ${item.name}
                                    </div>
                                    <div style="font-size: 12px; color: #8B6F47;">
                                        <span class="badge ${storeBadgeClass}">${storeIcon} ${item.store}</span>
                                        æ¬¡å›äºˆå®š: ${formatDate(item.nextDate)}
                                        ${item.daysLeft < 0 ? `(${Math.abs(item.daysLeft)}æ—¥çµŒé)` : 
                                          item.daysLeft === 0 ? '(ä»Šæ—¥)' : 
                                          `(ã‚ã¨${item.daysLeft}æ—¥)`}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `}).join('')}
                </div>
            `;
        }

        container.innerHTML = html;
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    function closeShoppingListModal() {
        document.getElementById('shoppingListModal').style.display = 'none';
    }

    // ã‚¹ã‚¯ã‚·ãƒ§ä¿å­˜ï¼ˆhtml2canvasã‚’ä½¿ã‚ãšã«ã‚·ãƒ³ãƒ—ãƒ«ã«å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ãï¼‰
    function captureScreenshot() {
        alert('ğŸ“¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ©Ÿèƒ½\n\nã‚¹ãƒãƒ›ã®å ´åˆ:\n1. ã“ã®ãƒ¢ãƒ¼ãƒ€ãƒ«å…¨ä½“ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ\n2. ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰åˆ‡ã‚Šå–ã‚Š\n\nPCã®å ´åˆ:\nã€Œå°åˆ·ã€ãƒœã‚¿ãƒ³ã§PDFä¿å­˜ã§ãã¾ã™');
    }

    // è²·ã„ç‰©ãƒªã‚¹ãƒˆå°åˆ·
    function printShoppingList() {
        window.print();
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
    window.onclick = function(event) {
        const modal = document.getElementById('shoppingListModal');
        if (event.target == modal) {
            closeShoppingListModal();
        }
        const editModal = document.getElementById('editItemModal');
        if (event.target == editModal) {
            closeEditModal();
        }
    }

    // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
    function openEditModal(itemId) {
        const item = items.find(i => i.id === itemId);
        if (!item) return;

        editingItemId = itemId;
        document.getElementById('editItemName').value = item.name;
        document.getElementById('editItemCycle').value = item.cycle;
        document.getElementById('editItemCategory').value = item.category;
        document.getElementById('editItemStore').value = item.store || 'ã‚¹ãƒ¼ãƒ‘ãƒ¼';

        document.getElementById('editItemModal').style.display = 'block';
    }

    // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    function closeEditModal() {
        document.getElementById('editItemModal').style.display = 'none';
        editingItemId = null;
    }

    // ç·¨é›†ã‚’ä¿å­˜
    function saveEditedItem() {
        const name = document.getElementById('editItemName').value.trim();
        const cycle = parseInt(document.getElementById('editItemCycle').value);
        const category = document.getElementById('editItemCategory').value;
        const store = document.getElementById('editItemStore').value;

        if (!name || !cycle) {
            alert('å“åã¨ä»•å…¥ã‚Œå‘¨æœŸã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
        }

        const itemIndex = items.findIndex(i => i.id === editingItemId);
        if (itemIndex === -1) return;

        // ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ›´æ–°
        items[itemIndex].name = name;
        items[itemIndex].cycle = cycle;
        items[itemIndex].category = category;
        items[itemIndex].store = store;

        // è³¼å…¥å±¥æ­´ã®å•†å“åã‚‚æ›´æ–°
        purchases.forEach(purchase => {
            if (purchase.itemId === editingItemId) {
                purchase.itemName = name;
            }
        });

        saveData();
        loadData();
        closeEditModal();
        alert('æ—¥ç”¨å“ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
    }

    // è³¼å…¥ãŒå¿…è¦ãªå•†å“æ•°ã‚’å–å¾—
    function getItemsNeedToBuy() {
        const list = generateShoppingList();
        return {
            urgent: list.filter(item => item.daysLeft < 0).length,
            soon: list.filter(item => item.daysLeft >= 0 && item.daysLeft <= 7).length
        };
    }

    // è²·ã„ç‰©ãƒªã‚¹ãƒˆç”Ÿæˆ
    function generateShoppingList() {
        const list = [];

        items.forEach(item => {
            const latestPurchase = purchases
                .filter(p => p.itemId === item.id)
                .sort((a, b) => new Date(b.purchaseDate) - new Date(a.purchaseDate))[0];

            if (latestPurchase) {
                const daysLeft = getDaysDiff(latestPurchase.nextPurchaseDate);
                list.push({
                    id: item.id,
                    name: item.name,
                    category: item.category,
                    store: item.store || 'ã‚¹ãƒ¼ãƒ‘ãƒ¼',
                    nextDate: latestPurchase.nextPurchaseDate,
                    daysLeft: daysLeft
                });
            } else {
                // è³¼å…¥è¨˜éŒ²ãŒãªã„å ´åˆã‚‚è¡¨ç¤º
                list.push({
                    id: item.id,
                    name: item.name,
                    category: item.category,
                    store: item.store || 'ã‚¹ãƒ¼ãƒ‘ãƒ¼',
                    nextDate: new Date().toISOString().split('T')[0],
                    daysLeft: 0
                });
            }
        });

        // æ—¥æ•°ã§ã‚½ãƒ¼ãƒˆ
        return list.sort((a, b) => a.daysLeft - b.daysLeft);
    }

    // è³¼å…¥å•†å“é¸æŠè‚¢èª­ã¿è¾¼ã¿
    function loadPurchaseSelect() {
        const select = document.getElementById('purchaseItem');
        select.innerHTML = '<option value="">å•†å“ã‚’é¸æŠã—ã¦ãã ã•ã„</option>' + 
            items.map(item => `<option value="${item.id}">${item.name} (${item.category})</option>`).join('');
    }

    // è³¼å…¥å±¥æ­´è¡¨ç¤º
    function loadHistory() {
        const container = document.getElementById('historyList');
        
        if (purchases.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“‹</div>
                    <p>è³¼å…¥å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>
                </div>
            `;
            return;
        }

        const sortedPurchases = purchases.sort((a, b) => 
            new Date(b.purchaseDate) - new Date(a.purchaseDate)
        );

        container.innerHTML = sortedPurchases.map(purchase => `
            <div class="history-item">
                <div>
                    <div style="font-weight: bold;">${purchase.itemName}</div>
                    <div style="font-size: 12px; color: #6c757d;">
                        è³¼å…¥æ—¥: ${formatDate(purchase.purchaseDate)} â†’ 
                        æ¬¡å›äºˆå®š: ${formatDate(purchase.nextPurchaseDate)}
                    </div>
                </div>
            </div>
        `).join('');
    }

    // ãƒ‡ãƒ¼ã‚¿çµ±è¨ˆè¡¨ç¤º
    function loadDataStats() {
        const container = document.getElementById('dataStats');
        container.innerHTML = `
            <div style="line-height: 1.8;">
                <p>ğŸ“¦ ç™»éŒ²å•†å“æ•°: <strong>${items.length}</strong> ä»¶</p>
                <p>ğŸ›ï¸ è³¼å…¥è¨˜éŒ²æ•°: <strong>${purchases.length}</strong> ä»¶</p>
                <p>ğŸ“… æœ€çµ‚æ›´æ–°: <strong>${new Date().toLocaleString('ja-JP')}</strong></p>
            </div>
        `;
    }

    // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    function exportData() {
        const data = {
            items: items,
            purchases: purchases,
            exportDate: new Date().toISOString()
        };

        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `shopping-data-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
    }

    // ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    function importData() {
        const file = document.getElementById('importFile').files[0];
        if (!file) {
            alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (confirm('ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ')) {
                    items = data.items || [];
                    purchases = data.purchases || [];
                    saveData();
                    loadData();
                    alert('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
                }
            } catch (error) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        };
        reader.readAsText(file);
    }

    // å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
    function clearAllData() {
        if (!confirm('æœ¬å½“ã«å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;
        if (!confirm('æœ€çµ‚ç¢ºèªï¼šå…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;

        items = [];
        purchases = [];
        saveData();
        loadData();
        alert('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
    }

    // å°åˆ·
    function printData() {
        window.print();
    }
</script>
```

</body>
</html>